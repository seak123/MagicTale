"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var engine_1 = require("engine");
var eventCenter_js_1 = require("../commons/eventCenter.js");
var SCREEN_WIDTH = engine_1.default.device.screenWidth;
var SCREEN_HEIGHT = engine_1.default.device.screenHeight;
var GAME_WIDTH = engine_1.default.adaptation.frameWidth;
var GAME_HEIGHT = engine_1.default.adaptation.frameHeight;
var D2Move = (function (_super) {
    tslib_1.__extends(D2Move, _super);
    function D2Move(entity) {
        var _this = _super.call(this, entity) || this;
        _this.entity = entity;
        _this.buttonPos = engine_1.default.Vector2.ZERO.clone();
        _this.buttonRadius = { x: 0, y: 0 };
        _this.direction = engine_1.default.Vector2.ZERO.clone();
        _this.uisprite = null;
        _this.uiInput = null;
        _this.onTouchStart = _this.onTouchStart.bind(_this);
        _this.onTouchEnter = _this.onTouchEnter.bind(_this);
        _this.onTouchMove = _this.onTouchMove.bind(_this);
        _this.onTouchEnd = _this.onTouchEnd.bind(_this);
        _this.onTouchLeave = _this.onTouchLeave.bind(_this);
        return _this;
    }
    D2Move.prototype.onAwake = function () {
        this.uisprite = this.entity.getComponent(engine_1.default.UISprite);
        this.buttonPos = this.entity.transform2D.worldPosition.clone();
        this.buttonRadius = { x: this.entity.transform2D.size.x / 2, y: this.entity.transform2D.size.y / 2 };
    };
    D2Move.prototype.onEnable = function () {
        this.uiInput = this.getComponent(engine_1.default.TouchInputComponent);
        if (this.uiInput) {
            this.uiInput.onTouchStart.add(this.onTouchStart);
            this.uiInput.onTouchEnter.add(this.onTouchEnter);
            this.uiInput.onTouchEnd.add(this.onTouchEnd);
            this.uiInput.onTouchLeave.add(this.onTouchLeave);
            this.uiInput.onTouchMove.add(this.onTouchMove);
        }
    };
    D2Move.prototype.onDisable = function () {
        if (this.uiInput) {
            this.uiInput.onTouchStart.remove(this.onTouchStart);
            this.uiInput.onTouchEnter.remove(this.onTouchEnter);
            this.uiInput.onTouchEnd.remove(this.onTouchEnd);
            this.uiInput.onTouchLeave.remove(this.onTouchLeave);
            this.uiInput.onTouchMove.remove(this.onTouchMove);
        }
    };
    D2Move.prototype.onTouchStart = function (s, e) {
        this.setAlpha(200);
        this.handleTouch(e);
    };
    D2Move.prototype.onTouchEnter = function (s, e) {
        this.setAlpha(200);
        this.handleTouch(e);
    };
    D2Move.prototype.onTouchMove = function (s, e) {
        this.handleTouch(e);
    };
    D2Move.prototype.onTouchLeave = function (s, e) {
        this.setAlpha(255);
        this.emitDirection({ x: 0, y: 0, z: 0 });
    };
    D2Move.prototype.onTouchEnd = function (s, e) {
        this.setAlpha(255);
        this.emitDirection({ x: 0, y: 0, z: 0 });
    };
    D2Move.prototype.handleTouch = function (e) {
        this.direction.x = e.touches[0].position.x / this.buttonRadius.x;
        this.direction.y = e.touches[0].position.y / this.buttonRadius.y;
        this.emitDirection({ x: this.direction.x, y: 0, z: -this.direction.y });
    };
    D2Move.prototype.setAlpha = function (val) {
        var c = this.uisprite.color.clone();
        c.a = val;
        this.uisprite.color = c;
    };
    D2Move.prototype.emitDirection = function (direction) {
        eventCenter_js_1.default.emit(eventCenter_js_1.default.TOUCH_MOVE, direction);
    };
    D2Move.prototype.gamePosToScreen = function (pos) {
        var p = engine_1.default.Vector2.ZERO.clone();
        p.x = SCREEN_WIDTH / GAME_WIDTH * pos.x;
        p.y = SCREEN_HEIGHT / GAME_HEIGHT * pos.y;
        return p;
    };
    D2Move.prototype.canvasPosToScreen = function (pos) {
        pos.x = pos.x - SCREEN_WIDTH / 2;
        pos.y = -pos.y + SCREEN_HEIGHT / 2;
        return pos;
    };
    D2Move = tslib_1.__decorate([
        engine_1.default.decorators.serialize("D2Move")
    ], D2Move);
    return D2Move;
}(engine_1.default.Script));
exports.default = D2Move;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNjcmlwdHMvY29tcG9uZW50cy9kMk1vdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0EsaUNBQTRCO0FBSTVCLDREQUFvRDtBQUVwRCxJQUFNLFlBQVksR0FBRyxnQkFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUM7QUFDL0MsSUFBTSxhQUFhLEdBQUcsZ0JBQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDO0FBQ2pELElBQU0sVUFBVSxHQUFHLGdCQUFNLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQztBQUNoRCxJQUFNLFdBQVcsR0FBRyxnQkFBTSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUM7QUFHbEQ7SUFBb0Msa0NBQWE7SUFPL0MsZ0JBQTRCLE1BQWdCO1FBQTVDLFlBQ0Usa0JBQU0sTUFBTSxDQUFDLFNBTWQ7UUFQMkIsWUFBTSxHQUFOLE1BQU0sQ0FBVTtRQU5yQyxlQUFTLEdBQUcsZ0JBQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3hDLGtCQUFZLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQztRQUM5QixlQUFTLEdBQUcsZ0JBQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3hDLGNBQVEsR0FBRyxJQUFJLENBQUM7UUFDaEIsYUFBTyxHQUFzQyxJQUFJLENBQUM7UUFJdkQsS0FBSSxDQUFDLFlBQVksR0FBRyxLQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxLQUFJLENBQUMsQ0FBQztRQUNqRCxLQUFJLENBQUMsWUFBWSxHQUFHLEtBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUksQ0FBQyxDQUFDO1FBQ2pELEtBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLENBQUM7UUFDL0MsS0FBSSxDQUFDLFVBQVUsR0FBRyxLQUFJLENB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VixJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7SUFDMUIsQ0FBQztJQUVNLDhCQUFhLEdBQXBCLFVBQXFCLFNBQStDO1FBQ2xFLHdCQUFXLENBQUMsSUFBSSxDQUFDLHdCQUFXLENBQUMsVUFBVSxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFFTSxnQ0FBZSxHQUF0QixVQUF1QixHQUFZO1FBQ2pDLElBQU0sQ0FBQyxHQUFHLGdCQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN0QyxDQUFDLENBQUMsQ0FBQyxHQUFHLFlBQVksR0FBRyxVQUFVLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUN4QyxDQUFDLENBQUMsQ0FBQyxHQUFHLGFBQWEsR0FBRyxXQUFXLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUMxQyxPQUFPLENBQUMsQ0FBQztJQUNYLENBQUM7SUFFTSxrQ0FBaUIsR0FBeEIsVUFBeUIsR0FBRztRQUUxQixHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsWUFBWSxHQUFHLENBQUMsQ0FBQztRQUNqQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxhQUFhLEdBQUcsQ0FBQyxDQUFDO1FBQ25DLE9BQU8sR0FBRyxDQUFDO0lBQ2IsQ0FBQztJQS9Ga0IsTUFBTTtRQUQxQixnQkFBTSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDO09BQ2pCLE1BQU0sQ0FnRzFCO0lBQUQsYUFBQztDQWhHRCxBQWdHQyxDQWhHbUMsZ0JBQU0sQ0FBQyxNQUFNLEdBZ0doRDtrQkFoR29CLE1BQU0iLCJmaWxlIjoiU2NyaXB0cy9jb21wb25lbnRzL2QyTW92ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCBlbmdpbmUgZnJvbSAnZW5naW5lJztcclxuaW1wb3J0IGVuZ2luZSBmcm9tIFwiZW5naW5lXCI7XHJcbmRlY2xhcmUgdHlwZSBWZWN0b3IyID0gaW1wb3J0KFwiZW5naW5lL2VuZ2luZVwiKS5WZWN0b3IyO1xyXG5kZWNsYXJlIHR5cGUgVG91Y2hJbnB1dEV2ZW50ID0gaW1wb3J0KFwiZW5naW5lL2lucHV0L3RvdWNoXCIpLlRvdWNoSW5wdXRFdmVudDtcclxuZGVjbGFyZSB0eXBlIEVudGl0eTJEID0gaW1wb3J0KFwiZW5naW5lL3NjZW5lL3NjZW5lXCIpLkVudGl0eTJEO1xyXG5pbXBvcnQgRXZlbnRDZW50ZXIgZnJvbSBcIi4uL2NvbW1vbnMvZXZlbnRDZW50ZXIuanNcIjtcclxuXHJcbmNvbnN0IFNDUkVFTl9XSURUSCA9IGVuZ2luZS5kZXZpY2Uuc2NyZWVuV2lkdGg7XHJcbmNvbnN0IFNDUkVFTl9IRUlHSFQgPSBlbmdpbmUuZGV2aWNlLnNjcmVlbkhlaWdodDtcclxuY29uc3QgR0FNRV9XSURUSCA9IGVuZ2luZS5hZGFwdGF0aW9uLmZyYW1lV2lkdGg7XHJcbmNvbnN0IEdBTUVfSEVJR0hUID0gZW5naW5lLmFkYXB0YXRpb24uZnJhbWVIZWlnaHQ7XHJcblxyXG5AZW5naW5lLmRlY29yYXRvcnMuc2VyaWFsaXplKFwiRDJNb3ZlXCIpXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEQyTW92ZSBleHRlbmRzIGVuZ2luZS5TY3JpcHQge1xyXG4gIHB1YmxpYyBidXR0b25Qb3MgPSBlbmdpbmUuVmVjdG9yMi5aRVJPLmNsb25lKCk7IC8vIOaMiemSrueahGNhbnZhc+WdkOagh1xyXG4gIHB1YmxpYyBidXR0b25SYWRpdXMgPSB7IHg6IDAsIHk6IDAgfTtcclxuICBwdWJsaWMgZGlyZWN0aW9uID0gZW5naW5lLlZlY3RvcjIuWkVSTy5jbG9uZSgpO1xyXG4gIHB1YmxpYyB1aXNwcml0ZSA9IG51bGw7XHJcbiAgcHVibGljIHVpSW5wdXQ6IGVuZ2luZS5Ub3VjaElucHV0Q29tcG9uZW50IHwgbnVsbCA9IG51bGw7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyByZWFkb25seSBlbnRpdHk6IEVudGl0eTJEKSB7XHJcbiAgICBzdXBlcihlbnRpdHkpO1xyXG4gICAgdGhpcy5vblRvdWNoU3RhcnQgPSB0aGlzLm9uVG91Y2hTdGFydC5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5vblRvdWNoRW50ZXIgPSB0aGlzLm9uVG91Y2hFbnRlci5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5vblRvdWNoTW92ZSA9IHRoaXMub25Ub3VjaE1vdmUuYmluZCh0aGlzKTtcclxuICAgIHRoaXMub25Ub3VjaEVuZCA9IHRoaXMub25Ub3VjaEVuZC5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5vblRvdWNoTGVhdmUgPSB0aGlzLm9uVG91Y2hMZWF2ZS5iaW5kKHRoaXMpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG9uQXdha2UoKSB7XHJcbiAgICB0aGlzLnVpc3ByaXRlID0gdGhpcy5lbnRpdHkuZ2V0Q29tcG9uZW50KGVuZ2luZS5VSVNwcml0ZSk7XHJcbiAgICB0aGlzLmJ1dHRvblBvcyA9IHRoaXMuZW50aXR5LnRyYW5zZm9ybTJELndvcmxkUG9zaXRpb24uY2xvbmUoKTtcclxuICAgIHRoaXMuYnV0dG9uUmFkaXVzID0geyB4OiB0aGlzLmVudGl0eS50cmFuc2Zvcm0yRC5zaXplLnggLyAyLCB5OiB0aGlzLmVudGl0eS50cmFuc2Zvcm0yRC5zaXplLnkgLyAyIH07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb25FbmFibGUoKTogdm9pZCB7XHJcbiAgICB0aGlzLnVpSW5wdXQgPSB0aGlzLmdldENvbXBvbmVudDxlbmdpbmUuVG91Y2hJbnB1dENvbXBvbmVudD4oZW5naW5lLlRvdWNoSW5wdXRDb21wb25lbnQpO1xyXG4gICAgaWYgKHRoaXMudWlJbnB1dCkge1xyXG4gICAgICB0aGlzLnVpSW5wdXQub25Ub3VjaFN0YXJ0LmFkZCh0aGlzLm9uVG91Y2hTdGFydCk7XHJcbiAgICAgIHRoaXMudWlJbnB1dC5vblRvdWNoRW50ZXIuYWRkKHRoaXMub25Ub3VjaEVudGVyKTtcclxuICAgICAgdGhpcy51aUlucHV0Lm9uVG91Y2hFbmQuYWRkKHRoaXMub25Ub3VjaEVuZCk7XHJcbiAgICAgIHRoaXMudWlJbnB1dC5vblRvdWNoTGVhdmUuYWRkKHRoaXMub25Ub3VjaExlYXZlKTtcclxuICAgICAgdGhpcy51aUlucHV0Lm9uVG91Y2hNb3ZlLmFkZCh0aGlzLm9uVG91Y2hNb3ZlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBvbkRpc2FibGUoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy51aUlucHV0KSB7XHJcbiAgICAgIHRoaXMudWlJbnB1dC5vblRvdWNoU3RhcnQucmVtb3ZlKHRoaXMub25Ub3VjaFN0YXJ0KTtcclxuICAgICAgdGhpcy51aUlucHV0Lm9uVG91Y2hFbnRlci5yZW1vdmUodGhpcy5vblRvdWNoRW50ZXIpO1xyXG4gICAgICB0aGlzLnVpSW5wdXQub25Ub3VjaEVuZC5yZW1vdmUodGhpcy5vblRvdWNoRW5kKTtcclxuICAgICAgdGhpcy51aUlucHV0Lm9uVG91Y2hMZWF2ZS5yZW1vdmUodGhpcy5vblRvdWNoTGVhdmUpO1xyXG4gICAgICB0aGlzLnVpSW5wdXQub25Ub3VjaE1vdmUucmVtb3ZlKHRoaXMub25Ub3VjaE1vdmUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIG9uVG91Y2hTdGFydChzOiBlbmdpbmUuVG91Y2hJbnB1dENvbXBvbmVudCwgZTogVG91Y2hJbnB1dEV2ZW50KSB7XHJcbiAgICB0aGlzLnNldEFscGhhKDIwMCk7XHJcbiAgICB0aGlzLmhhbmRsZVRvdWNoKGUpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG9uVG91Y2hFbnRlcihzOiBlbmdpbmUuVG91Y2hJbnB1dENvbXBvbmVudCwgZTogVG91Y2hJbnB1dEV2ZW50KSB7XHJcbiAgICB0aGlzLnNldEFscGhhKDIwMCk7XHJcbiAgICB0aGlzLmhhbmRsZVRvdWNoKGUpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG9uVG91Y2hNb3ZlKHM6IGVuZ2luZS5Ub3VjaElucHV0Q29tcG9uZW50LCBlOiBUb3VjaElucHV0RXZlbnQpIHtcclxuICAgIHRoaXMuaGFuZGxlVG91Y2goZSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb25Ub3VjaExlYXZlKHM6IGVuZ2luZS5Ub3VjaElucHV0Q29tcG9uZW50LCBlOiBUb3VjaElucHV0RXZlbnQpIHtcclxuICAgIHRoaXMuc2V0QWxwaGEoMjU1KTtcclxuICAgIHRoaXMuZW1pdERpcmVjdGlvbih7IHg6IDAsIHk6IDAsIHo6IDAgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb25Ub3VjaEVuZChzOiBlbmdpbmUuVG91Y2hJbnB1dENvbXBvbmVudCwgZTogVG91Y2hJbnB1dEV2ZW50KSB7XHJcbiAgICB0aGlzLnNldEFscGhhKDI1NSk7XHJcbiAgICB0aGlzLmVtaXREaXJlY3Rpb24oeyB4OiAwLCB5OiAwLCB6OiAwIH0pO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGhhbmRsZVRvdWNoKGU6IFRvdWNoSW5wdXRFdmVudCkge1xyXG4gICAgdGhpcy5kaXJlY3Rpb24ueCA9IGUudG91Y2hlc1swXS5wb3NpdGlvbi54IC8gdGhpcy5idXR0b25SYWRpdXMueDtcclxuICAgIHRoaXMuZGlyZWN0aW9uLnkgPSBlLnRvdWNoZXNbMF0ucG9zaXRpb24ueSAvIHRoaXMuYnV0dG9uUmFkaXVzLnk7XHJcbiAgICB0aGlzLmVtaXREaXJlY3Rpb24oeyB4OiB0aGlzLmRpcmVjdGlvbi54LCB5OiAwLCB6OiAtdGhpcy5kaXJlY3Rpb24ueSB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXRBbHBoYSh2YWw6IG51bWJlcik6IHZvaWQge1xyXG4gICAgY29uc3QgYyA9IHRoaXMudWlzcHJpdGUuY29sb3IuY2xvbmUoKTtcclxuICAgIGMuYSA9IHZhbDtcclxuICAgIHRoaXMudWlzcHJpdGUuY29sb3IgPSBjO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGVtaXREaXJlY3Rpb24oZGlyZWN0aW9uOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyOyB6OiBudW1iZXI7IH0pOiB2b2lkIHtcclxuICAgIEV2ZW50Q2VudGVyLmVtaXQoRXZlbnRDZW50ZXIuVE9VQ0hfTU9WRSwgZGlyZWN0aW9uKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnYW1lUG9zVG9TY3JlZW4ocG9zOiBWZWN0b3IyKTogVmVjdG9yMiB7XHJcbiAgICBjb25zdCBwID0gZW5naW5lLlZlY3RvcjIuWkVSTy5jbG9uZSgpO1xyXG4gICAgcC54ID0gU0NSRUVOX1dJRFRIIC8gR0FNRV9XSURUSCAqIHBvcy54O1xyXG4gICAgcC55ID0gU0NSRUVOX0hFSUdIVCAvIEdBTUVfSEVJR0hUICogcG9zLnk7XHJcbiAgICByZXR1cm4gcDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjYW52YXNQb3NUb1NjcmVlbihwb3MpIHtcclxuICAgIC8vIGNvbnNvbGUubG9nKHBvcyk7XHJcbiAgICBwb3MueCA9IHBvcy54IC0gU0NSRUVOX1dJRFRIIC8gMjtcclxuICAgIHBvcy55ID0gLXBvcy55ICsgU0NSRUVOX0hFSUdIVCAvIDI7XHJcbiAgICByZXR1cm4gcG9zO1xyXG4gIH1cclxufVxyXG4iXX0=
